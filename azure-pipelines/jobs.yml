parameters:
  - name: "jobName"
    type: string
  - name: "vmImage"
    type: string
  - name: "working_directories"
    type: object

jobs:
  - job: ${{ parameters.jobName }}
    pool:
      vmImage: ${{ parameters.vmImage }}
    steps:
      - template: ./templates/setup.yml
        parameters:
          working_directory: $(working_directory)
      - template: ./templates/build.yml
        parameters:
          working_directory: $(working_directory)
      - template: ./templates/test.yml
        parameters:
          working_directory: $(working_directory)
      - template: ./templates/package.yml
        parameters:
          working_directory: $(working_directory)
          artifact_name: $(artifact_name)
    variables:
      Codeql.Enabled: $[and(in(variables['Build.Reason'], 'Schedule'), eq(variables['Agent.OS'], 'Linux'))] # Enable CodeQL only on Linux+scheduled builds because it is slow
    strategy:
      matrix:
        eslint-config-azuretools:
          artifact_name: eslint-config-azuretools
          working_directory: eslint-config-azuretools

  - job: ${{ parameters.jobName}}_Compliance
    pool:
      vmImage: ${{ parameters.vmImage }}
    steps:
      - template: ./compliance/compliance.yml
    condition: or(in(variables['Build.Reason'], 'Manual', 'Schedule'), eq(variables['EnableCompliance'], 'true'))
    variables:
      Codeql.Enabled: $[and(in(variables['Build.Reason'], 'Schedule'), eq(variables['Agent.OS'], 'Linux'))] # Enable CodeQL only on Linux+scheduled builds because it is slow

