steps:
  - task: Npm@1
    displayName: "\U0001F449 Test"
    inputs:
      command: custom
      customCommand: test
      workingDir: $(working_directory)
    condition: succeeded()
    env:
      DISPLAY: :99 # Only necessary for linux tests
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)

  # This task obtains the values necessary to connect to the AzCodeE2ETests service connection from the AzCodeE2ETestsCredKV key vault.
  - task: AzureKeyVault@2
    inputs:
      azureSubscription: 'AzCodeE2ETests'
      KeyVaultName: 'AzCodeE2ETestsCredsKV'
      SecretsFilter: 'AzCodeServiceConnectionID, AzCodeServiceConnectionDomain, AzCodeServiceConnectionClientID'
      RunAsPreJob: true

  # This gives the AzCodeE2ETests service connection access to this pipeline.
  - task: AzureKeyVault@1
    displayName: 'Authorize AzCodeE2ETests service connection'
    inputs:
      azureSubscription: 'AzCodeE2ETests'
      KeyVaultName: 'AzCodeE2ETestsDummyKV'
    env:
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)
