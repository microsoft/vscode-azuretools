# Trigger the build whenever `main` is updated
trigger:
  - main
  - rel/*

pr: none # Disable PR trigger

# Scheduled nightly build
schedules:
  - cron: "0 0 * * *"
    displayName: Nightly scheduled build
    always: false # Don't rebuild if there haven't been changes
    branches:
      include:
        - main

parameters:
  - name: PackageToBuild
    displayName: Package to Build
    type: string
    values:
      - all
      - microsoft-vscode-azext-azureappservice
      - microsoft-vscode-azext-azureappsettings
      - microsoft-vscode-azext-azureauth
      - microsoft-vscode-azext-azureutils
      - microsoft-vscode-azext-dev
      - microsoft-eslint-config-azuretools
      - microsoft-vscode-azext-github
      - microsoft-vscode-azext-serviceconnector
      - microsoft-vscode-azext-utils

# Use the templates
extends:
  template: ../azure-pipelines/jobs.yml
  parameters:
    jobs:
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-azureappservice'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: appservice
          working_directory: appservice
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-azureappsettings'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: appsettings
          working_directory: appsettings
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-azureauth'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: auth
          working_directory: auth
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-azureutils'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: azure
          working_directory: azure
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-dev'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: dev
          working_directory: dev
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-eslint-config-azuretools'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: eslint_config_azuretools
          working_directory: eslint-config-azuretools
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-github'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: github
          working_directory: github
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-serviceconnector'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: serviceconnector
          working_directory: serviceconnector
      - ${{ if or(eq(parameters.PackageToBuild, 'microsoft-vscode-azext-utils'), eq(parameters.PackageToBuild, 'all')) }}:
        - name: utils
          working_directory: utils
